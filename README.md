## 동시성 제어 방식
다양한 동시성 제어 방식 중에서 고려할 수 있는 방법을 제시하며, 각 방법의 장단점과 적합성을 분석합니다.

1️⃣ DB 트랜잭션 + 비관적 락 (Pessimistic Locking)
1) 방법: 좌석 예약 및 관련 동작에서 데이터베이스의 비관적 락을 활용하여 동시 접근을 차단.

예약 시 SELECT ... FOR UPDATE 쿼리를 사용하여 특정 좌석의 데이터를 잠금.
다른 트랜잭션은 락이 해제될 때까지 대기.

2) 장점:
데이터 충돌을 원천적으로 차단.
동시성 문제가 발생하지 않아 데이터 무결성 보장.
구현이 비교적 간단하며, JPA 또는 ORM에서 기본 제공.

3) 단점:
성능 저하: 다수의 사용자가 동시에 요청 시, 락으로 인해 대기 시간이 증가.
락 대기 중 타임아웃 가능성.

4) 적합성:
임시 좌석 배정과 결제 처리 시 높은 데이터 무결성이 필요하므로 적합.

2️⃣ DB 트랜잭션 + 낙관적 락 (Optimistic Locking)
1) 방법: 좌석 데이터를 갱신할 때 버전 번호(@Version)를 사용하여 변경 전후 상태를 비교.

갱신 전 상태와 갱신 후 상태를 비교하여 충돌을 감지.
충돌 발생 시 재시도 로직 구현.

2) 장점:
락을 사용하지 않아 동시성 처리 성능이 뛰어남.
트랜잭션 간 대기 시간이 없음.

3) 단점:
재시도 비용 발생: 충돌 발생 시 동일 작업을 다시 시도해야 함.
데이터 무결성을 개발자가 직접 관리해야 함.
4) 적합성:
잔액 충전이나 대기열 관리처럼 동시성 충돌 가능성이 낮은 경우 적합.

3️⃣ Redis 분산 락
1) 방법: Redis의 SETNX 명령어를 활용하여 특정 리소스(좌석)에 대한 락을 설정.
락의 유효 시간을 설정해 만료된 좌석 자동 해제를 지원.
분산 환경에서도 동작 가능.

2) 장점:
분산 시스템에서 동시성 제어 가능.
성능이 뛰어나며, 락 만료 기능으로 타이머 관리에 유리.

3) 단점:
Redis 장애 시 시스템이 정상적으로 동작하지 않을 수 있음.
구현 복잡도 증가 (예: 분산 락 재설정, 락 해제 보장).

4) 적합성:
임시 배정 타이머 관리 및 좌석 예약 동시성 제어에 적합.

4️⃣ 큐잉 시스템 (RabbitMQ, Kafka 등)
1) 방법: 좌석 예약 요청을 큐에 저장하고, 요청을 순차적으로 처리하여 동시성 문제를 해결.
예약 요청이 들어오면 대기열에 추가.
큐에서 하나씩 작업을 처리하며 좌석 상태를 업데이트.

2) 장점:
동시성 문제를 완전히 제거.
트랜잭션 충돌이 발생하지 않음.

3) 단점:
요청 처리 속도가 큐 소비 속도에 의존.
실시간성이 중요한 경우 적합하지 않을 수 있음.
외부 메시지 브로커 도입으로 구현 복잡도 증가.

4) 적합성:
대기열 관리 및 좌석 예약 요청 처리에 적합.

5️⃣ 애플리케이션 레벨 락 (Java Concurrent API)
1) 방법: Java의 ReentrantLock 또는 synchronized 키워드를 활용하여 동시성 제어.
특정 좌석 번호를 키로 사용하여 락을 설정.
락 해제를 보장하도록 설계.

2) 장점:
구현이 간단하며, 데이터베이스에 의존하지 않음.
애플리케이션 레벨에서 관리 가능.

3) 단점:
분산 환경에서 비효율적: 여러 애플리케이션 인스턴스에서 락이 공유되지 않음.
단일 서버 환경에만 적합.

4) 적합성:
단일 서버 환경에서 빠르게 테스트할 때 적합.


## 권장 접근 방식
대기열 관리
: Redis를 활용한 분산 락 또는 큐잉 시스템(RabbitMQ)을 사용.
대기열 순서를 유지하며, 폴링 방식과 함께 효율적으로 동작 가능.

좌석 예약 및 임시 배정
: DB 비관적 락을 사용해 데이터 충돌을 방지.
Redis를 활용해 임시 배정 타이머를 관리.

결제 처리
: 비관적 락을 통해 좌석 소유권 변경 시 무결성을 보장.

잔액 충전 및 조회
낙관적 락을 사용해 높은 성능과 간단한 동시성 제어를 구현.


## 정리
구현의 복잡도: Redis 분산 락 > 큐잉 시스템 > 비관적 락 > 낙관적 락 > 애플리케이션 레벨 락
성능: 큐잉 시스템 > Redis 분산 락 > 낙관적 락 > 비관적 락 > 애플리케이션 레벨 락
효율성(실시간성): Redis 분산 락 > 낙관적 락 > 큐잉 시스템 > 비관적 락 > 애플리케이션 레벨 락
적절한 조합으로 요구사항에 맞는 동시성 제어를 설계 및 구현하면 안정적이고 확장 가능한 예약 시스템을 구축 가능할 것으로 보입니다.


